<html>
    <head>
        <title>School club</title>
        <script src="https://unpkg.com/vue"> </script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

    </head>
    <body>
        <div id="app" class="container">
            <header>
                <nav class="navbar navbar-light bg-light">
                    <h1 v-text="sitename"></h1>
                    <a href="javascript:void(0)" v-on:click="cartPage = !cartPage" v-if="!cartPage">
                        <i class="fa fa-shopping-cart float-left" style="font-size: 48px;color: cadetblue;">
                            <span style="font-size: 20px; top: 0; position: absolute;">{{cart.length}}</span>
                        </i>
                    </a>
                    <button style="font-size: 20px;" class="btn btn-dark" @click="cartPage = !cartPage" v-else>Go Back</button>

                </nav>
                <!--<button v-on:click='showCheckout'>
                    {{cartItemCount}} Check out
                </button>-->

            </header>
            <div v-if="cartPage">
                <div class="row">
                    <h2>Shopping Cart</h2>
                </div>
                    <div class="row">
                        <div v-if="cart" v-for='lesson in cart' class="col-3 card p-2 m-2">
                            <div class="card-body" v-if="lesson.availableSpaces > 0">
                                <h4 v-text="lesson.subject"></h4>
                                <img v-bind:src="lesson.image" height="125px" width="125px">
                                <p v-text="lesson.location"></p>
                                <p>Price: £{{lesson.price}} per hour</p>
                                <p>Spaces available {{lesson.availableSpaces}}</p>
                                <button class="btn btn-danger"  v-on:click='removeFromCart(lesson)'>
                                    Remove from cart
                                </button>
                            </div>
                        </div>

                        <div v-else> Empty </div>
                    </div>
                    <div class="row" v-if="cart.length > 0">
                        <div>
                            <form>
                                <h2>Checkout</h2>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="first"> Name</label>
                                            <input v-model="name" type="text" class="form-control" placeholder="Full Name" id="first">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="phone">Phone Number</label>
                                            <input v-model="phone" type="number" class="form-control" id="Phone" placeholder="phone">
                                        </div>
                                    </div>
                                </div>
                                <button @click="submitCheckout" v-if="name !== null && phone !== null" type="submit" class="btn btn-primary">Checkout</button>
                            </form>
                        </div>
                    </div>

            </div>
            <div class="row" v-else>
                <div class="col-2 card mt-2 p-2 h-100">
                    <ul>
                        <li> <input type="checkbox" v-on:click="sortBy()" v-model="bySubject" name="Subject"> Subject</li>
                        <li> <input type="checkbox" v-on:click="sortBy()" v-model="byLocation" name="Location"> Location</li>
                        <li> <input type="checkbox" v-on:click="sortBy()" v-model="byPrice" name="Price"> Price</li>
                        <li> <input type="checkbox" v-on:click="sortBy()" v-model="byAvailability" name="Availability"> Availability</li>
                        <br/>
                        <li> <input type="checkbox" v-on:click="sortBy()" v-model="byAscending" name="Ascending"> Ascending</li>
                        <li> <input type="checkbox" v-on:click="sortBy()" v-model="byDescending" name="Descending"> Descending</li>
                    </ul>
                </div>
                <div class="col-10">
                    <div class="row">
                        <div v-if="lessons.length> 0 && lesson.availableSpaces > 0" v-for='lesson in lessons' class="col-3 w-100 card p-2 m-2">
                            <div class="card-body" >
                                <h1 v-text="lesson.subject"></h1>
                                <img v-bind:src="lesson.image" height="125px" width="125px">
                                <p v-text="lesson.location"></p>
                                <p>Price: £{{lesson.price}} per hour</p>
                                <p>Spaces available {{lesson.availableSpaces}}</p>
                                <button class="btn btn-primary" v-on:click='addToCart(lesson)' v-if="lesson.availableSpaces > 0">
                                    Add to cart
                                </button>
                                <button class="btn btn-primary" disabled='disabled' v-else>
                                    Add to cart
                                </button>
                            </div>
                        </div>
                        <div v-else> <!-- checkout page--> </div>
                    </div>
                </div>
            </div>

        </div>
        

        <script type="text/javascript">
        var webstore = new Vue({ 
            el: '#app', 
            data: {
                sitename: 'School club',
                lessons: [
                    {
                        id: 1,
                        subject: "Spanish",
                        location: "Hendon",
                        price: 15,
                        image: "book.jpg",
                        availableSpaces: 5,
                    },
                    {
                        id: 2,
                        subject: "Economic",
                        location: "Barnet",
                        price: 20,
                        image: "book.jpg",
                        availableSpaces: 5,
                    },
                    {
                        id: 3,
                        subject: "Math",
                        location: "Borehamwood",
                        price: 25,
                        image: "book.jpg",
                        availableSpaces: 5,
                    },
                    {
                        id: 4,
                        subject: "Music",
                        location: "Finchley",
                        price: 25,
                        image: "book.jpg",
                        availableSpaces: 5,
                    },
                    {
                        id: 5,
                        subject: "French",
                        location: "Hertfordshire",
                        price: 63,
                        image: "book.jpg",
                        availableSpaces: 5,
                    },
                    {
                        id: 6,
                        subject: "History",
                        location: "Mill Hill",
                        price: 60,
                        image: "book.jpg",
                        availableSpaces: 5,
                    },
                    {
                        id: 7,
                        subject: "Polish",
                        location: "Barnet",
                        price: 25,
                        image: "book.jpg",
                        availableSpaces: 5,
                    },
                    {
                        id: 8,
                        subject: "French",
                        location: "New Cross",
                        price: 45,
                        image: "book.jpg",
                        availableSpaces: 5,
                    },
                    {
                        id: 9,
                        subject: "Law",
                        location: "Ladbroke Grove",
                        price: 22,
                        image: "book.jpg",
                        availableSpaces: 5,
                    },
                    {
                        id: 10,
                        subject: "German",
                        location: "Barnet",
                        price: 50,
                        image: "book.jpg",
                        availableSpaces: 5,
                    },

                ],
                cart: [], 
                showProduct: true,

                bySubject: false,
                byLocation: false,
                byPrice: false,
                byAvailability: false,
                byAscending: false,
                byDescending: false,

                cartPage: false,
                name: null,
                phone: null,
            },
            methods: {
                addToCart: function(lesson){
                    let less = lesson

                    if (this.cart.length > 0) {
                        console.log('if ', less)
                        if (this.cart.find(x => x.id === less.id)){
                            for (let k in this.cart) {
                                if(this.cart[k].id === less.id) {
                                    this.cart[k].availableSpaces += 1
                                }
                            }
                        }
                        else {
                            this.cart.push(
                                {
                                    id: less.id,
                                    subject: less.subject,
                                    location: less.location,
                                    price: less.price,
                                    image: less.image,
                                    availableSpaces: 1,
                                }
                            )
                        }
                    }
                    else {
                        this.cart.push(
                            {
                                id: less.id,
                                subject: less.subject,
                                location: less.location,
                                price: less.price,
                                image: less.image,
                                availableSpaces: 1,
                            }
                        )
                    }

                    for(let m in this.lessons) {
                        if (this.lessons[m].id === less.id) {
                            this.lessons[m].availableSpaces -= 1
                        }
                    }
                },

                sortBy() {
                    if (this.bySubject) {
                        this.lessons.sort((a, b) => a.subject < b.subject ? 1 : -1);
                    }

                    if (this.byLocation) {
                        this.lessons.sort((a, b) => a.location < b.location ? 1 : -1);
                    }

                    if (this.byPrice) {
                        this.lessons.sort((a, b) => a.price < b.price ? 1 : -1);
                    }
                    if (this.byAvailability) {
                        this.lessons.sort((a, b) => a.availableSpaces < b.availableSpaces ? 1 : -1);
                    }

                    if (this.byAscending) {
                        this.lessons.sort((a, b) => a.subject < b.subject ? 1 : -1);
                    }

                    if (this.byDescending) {
                        this.lessons.sort((a, b) => a.subject > b.subject ? 1 : -1);
                    }
                },
                removeFromCart(lesson) {
                    let sub = []
                    this.cart.forEach(function (x) {
                        if (x.id !== lesson.id) {
                            sub.push(x)
                        }
                    })
                    this.cart = sub
                    if (this.lessons.find(x => x.id === lesson.id)) {
                        for (let h in this.lessons) {
                            if(this.lessons[h].id === lesson.id) {
                                this.lessons[h].availableSpaces += lesson.availableSpaces
                            }
                        }
                    }
                    else {
                        this.lessons.push(lesson)
                    }
                },
                submitCheckout() {
                    if (this.name && this.phone) {
                        swal("Order Submitted  ");
                    }
                    this.name = null
                    this.phone = null
                    this.cart = [];
                    this.cartPage = false
                }
            },
            computed: {
                //computed property object
                cartItemCount: function (){
                    return this.cart.length || ''; 
                },
                available : function (){ 
                    return this.product.availableSpaces > this.cartItemCount;
                }
            },
            created() {
            }
        });
        </script>
    </body>
</html>